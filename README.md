# Внешняя компонента для мобильной платформы 1С (Android)

## Описание
Компонента содержит нативную (C++) и Java часть. Используется в мобильной платформе 1С на Android. В проекте есть:
- Visual Studio solution для C++ (androidUtils.sln)
- Android Studio/Gradle проект (android/)

## Требования
- Android Studio (актуальная версия)
- Android SDK + NDK (clang)
- Платформа 1С не ниже 8.3.10

## Ограничения
- Поддерживается Android начиная с API 22
- Основная целевая архитектура телефонов: arm64-v8a

## API компоненты
### Методы
- BluetoothPrint / ПечатьБлютуз(Адрес, Данные) - печать по Bluetooth на указанный MAC
- ConnectPrinter / ПодключитьПринтер(Адрес) - предварительное подключение для серии чеков
- DisconnectPrinter / ОтключитьПринтер() - разрыв соединения
- SetIdleDisconnectMs / УстановитьТаймаутОтключения(МС) - авто-отключение после простоя, 0 = не отключать
- SetUseInsecureSocket / ИспользоватьНебезопасныйСокет(Да/Нет) - быстрее подключение, но может быть менее совместимо
- GetDevices / ПолучитьСписокУстройств(ТолькоПринтеры) - возвращает строку с устройствами, по одному в строке, формат Имя|MAC

### Свойства
- Нет

## Примеры использования в 1С
### Инициализация и пауза
```bsl
Если ПодключитьВнешнююКомпоненту("ОбщийМакет.Компонента", "PRINTTECH", ТипВнешнейКомпоненты.Native) Тогда
    Компонента = Новый("AddIn.PRINTTECH.PRINTADDIN");
    Компонента.УстановитьТаймаутОтключения(60000); // 60 секунд, 0 = без авто-отключения
    Компонента.ИспользоватьНебезопасныйСокет(Истина); // быстрее подключение
    Компонента.ПодключитьПринтер("00:11:22:33:44:55");
    Компонента.ПечатьБлютуз("00:11:22:33:44:55", "Тест печати");
    Компонента.ОтключитьПринтер();
КонецЕсли;
```

### Получение списка устройств
```bsl
Если ПодключитьВнешнююКомпоненту("ОбщийМакет.Компонента", "PRINTTECH", ТипВнешнейКомпоненты.Native) Тогда
    Компонента = Новый("AddIn.PRINTTECH.PRINTADDIN");
    // Ложь = все устройства, Истина = только принтеры (фильтрация по классу Bluetooth)
    Список = Компонента.ПолучитьСписокУстройств(Ложь);
    // Каждая строка: Имя|MAC
    Сообщить(Список);
КонецЕсли;
```

Примечание: на Android 12+ для доступа к списку устройств может требоваться разрешение Bluetooth (например, BLUETOOTH_CONNECT).

## Сборка
### Вариант 1: Gradle (рекомендуется, C++ + APK)
1) Откройте каталог android в Android Studio или используйте Gradle из консоли.
2) Убедитесь, что установлены SDK Platform 34, Build Tools 34, CMake.
3) В android/app/build.gradle указана версия NDK.
4) Запустите сборку:
```
cd android
./gradlew :app:assembleRelease
```
Результаты:
- APK: android/app/build/outputs/apk/release/
- Нативные библиотеки (.so): android/app/build/intermediates/cxx/RelWithDebInfo/<id>/obj/

### Вариант 2: Visual Studio (только C++)
Откройте androidUtils.sln и соберите Release для нужных платформ.

## Подготовка пакета для 1С
1) Возьмите .so для нужной архитектуры (обычно arm64-v8a).
2) Поместите .so и APK в папку package.
3) Обновите package/MANIFEST.XML под имена файлов.
4) Заархивируйте содержимое package в zip и загрузите в 1С как макет внешней компоненты.

## Лицензия
MIT. См. файл LICENSE.
